<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimised Search Engine</title>
    <!-- Load Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons --><script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom font import for modern look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a; /* Deep charcoal black base */
            color: #e0ffe0; /* Light green-tinged text */
            background-attachment: fixed;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        /* --- STATIC BACKGROUND IMAGE INTEGRATION --- */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* Behind all content */
            
            /* Use the single provided image URL */
            background-image: url('https://cdn.pixabay.com/photo/2015/12/15/05/43/starry-night-1093721_1280.jpg');
            background-size: cover; /* Ensures the image covers the whole viewport */
            background-repeat: no-repeat;
            background-attachment: fixed; /* Keeps the background static */
            background-position: center center;
            
            /* Apply a dark, slightly green overlay for readability/theme consistency */
            filter: brightness(0.7) grayscale(0.1); 
            opacity: 0.9;
        }

        /* --- END STATIC BACKGROUND --- */

        .search-container {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }
        .shadow-custom {
            box-shadow: 0 4px 20px -1px rgba(0, 255, 0, 0.1), 0 2px 10px -2px rgba(0, 255, 0, 0.05); /* Green glow effect */
        }
        .text-gradient {
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
        }
        .glow-shadow {
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5); /* Stronger green glow */
        }
        .modal-content-scroll {
            max-height: 70vh;
            overflow-y: auto;
        }
        /* Custom styles for the API Answer output */
        #api-answer-box .source-link {
            text-decoration: underline;
            text-decoration-color: #34d399; /* emerald-400 */
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">
    
    <div class="search-container pt-10">
        <!-- Header --><header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-extrabold">
                <span class="text-gradient bg-gradient-to-r from-green-400 to-emerald-500">Optimised Search Engine</span>
            </h1>
            <p class="text-white mt-2">Data Structures With C (Project Based Learning)</p>
        </header>

        <!-- Search Input Bar --><div id="search-bar-wrapper" class="relative">
            <!-- Hidden Category Selector (Used internally for filtering) -->
            <select id="category-select" class="hidden">
                <option value="All">All Categories</option>
                <option value="Engineering">Engineering</option>
                <option value="Animals">Animals</option>
                <option value="Art">Art</option>
                <option value="Food">Food</option>
                <option value="Music">Music</option>
                <option value="Famous_Landmarks">Famous_Landmarks</option>
            </select>
            
            <input type="text" id="search-input" placeholder="Enter query (e.g., 'data structure' or 'robotics engineering')"
                    class="w-full p-4 pl-12 text-lg rounded-xl border border-green-700 bg-gray-900 text-green-200 focus:ring-green-500 focus:border-green-500 shadow-custom transition duration-200"
                    onkeyup="handleInput(event)">
            
            <i data-lucide="search" class="absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-green-500"></i>
            <button onclick="handleSearchClick()" id="searchButton"
                class="absolute right-0 top-0 h-full px-5 text-black bg-green-500 rounded-r-xl hover:bg-green-600 transition duration-150 transform hover:scale-[1.01] hover:shadow-lg">
                Search
            </button>
            
            <!-- Suggestions Dropdown --><ul id="suggestion-list" class="absolute z-10 w-full mt-2 bg-gray-900 border border-green-700 rounded-xl shadow-lg max-h-48 overflow-y-auto hidden">
                <!-- Suggestions will be rendered here --></ul>
        </div>
        
        <!-- Main Content Area --><div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-10">

            <!-- Sidebar (Column 1) -->
            <div class="md:col-span-1">
                
                <!-- Recent Searches Panel (Original position) -->
                <div class="bg-gray-900 p-6 rounded-xl shadow-2xl border border-green-700 glow-shadow mb-8">
                    <h2 class="text-xl font-semibold mb-4 flex items-center text-green-400">
                        <i data-lucide="history" class="h-5 w-5 mr-2"></i> Recent Searches
                    </h2>
                    <ul id="recent-searches-list" class="space-y-2 text-sm">
                        <li class="text-gray-500 italic">No recent searches yet.</li>
                    </ul>
                </div>
                
                <!-- NEW: Category Browser Panel -->
                <div class="bg-gray-900 p-6 rounded-xl shadow-2xl border border-green-700 glow-shadow">
                    <h2 class="text-xl font-semibold mb-4 flex items-center text-emerald-400">
                        <i data-lucide="folder-tree" class="h-5 w-5 mr-2"></i> Browse Categories
                    </h2>
                    <ul id="category-browser-list" class="space-y-2 text-sm">
                        <!-- Category list rendered here by JS -->
                    </ul>
                </div>
                
            </div>

            <!-- Search Results Area (Columns 2 & 3) --><div class="md:col-span-2">
                <div class="bg-gray-900 p-6 rounded-xl shadow-2xl border border-green-700 min-h-64">
                    
                    <!-- NEW: AI Answer Box (Above Results Header) -->
                    <div id="api-answer-box" class="mb-6 p-4 bg-gray-800/70 rounded-xl border border-emerald-700 hidden">
                        <h2 class="text-xl font-bold mb-3 flex items-center text-emerald-400">
                            <i data-lucide="bot" class="h-5 w-5 mr-2"></i> AI Answer
                        </h2>
                        <div id="gemini-answer-content" class="text-base text-gray-200 leading-relaxed">
                            <!-- Answer content, loading spinner, or error message goes here -->
                        </div>
                        <div id="gemini-answer-sources" class="mt-3 text-xs text-gray-400 italic">
                            <!-- Sources go here -->
                        </div>
                    </div>

                    <h2 class="text-xl font-semibold mb-4 flex items-center text-green-400" id="results-header">
                        <i data-lucide="list-checks" class="h-5 w-5 mr-2"></i> Search Results
                    </h2>
                    <div id="results-container" class="space-y-4">
                        <p class="text-gray-500 italic" id="initial-message">Enter a query to see ranked results from the local C index, or click a category to browse files.</p>
                        <!-- Results are dynamically inserted here --></div>
                    <div id="loading-indicator" class="hidden text-center mt-8">
                        <svg class="animate-spin h-8 w-8 text-green-400 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="mt-2 text-gray-400">Connecting to local C engine...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Document Viewer Modal --><div id="documentModal" class="fixed inset-0 bg-black bg-opacity-80 backdrop-blur-sm hidden z-50 p-4 md:p-8">
        <div class="bg-gray-900 rounded-xl shadow-2xl max-w-4xl mx-auto mt-4 modal-content-scroll">
            <div class="sticky top-0 bg-gray-900 border-b border-gray-800 p-4 flex justify-between items-center z-10">
                <h2 id="modalTitle" class="text-xl font-bold text-white">Document Viewer: [Filename]</h2>
                <button onclick="closeModal()" class="text-gray-400 hover:text-green-400 transition duration-150">
                    <i data-lucide="x" class="h-6 w-6"></i>
                </button>
            </div>
            <div class="p-4 md:p-6">
                <!-- LLM Summary Section -->
                <div class="mb-6 p-4 bg-gray-800 rounded-lg border border-green-700 shadow-lg">
                    <h3 class="text-lg font-semibold mb-2 text-emerald-400 flex items-center">
                        <i data-lucide="message-square" class="h-5 w-5 mr-2"></i> Summary
                    </h3>
                    <div id="modalSummary" class="text-base font-semibold text-gray-300">
                            <!-- Content managed by JS -->
                    </div>
                    <div id="summaryControls" class="mt-4">
                        <!-- Controls (Button/Loading) managed by JS -->
                    </div>
                </div>

                <!-- Raw Document Content -->
                <h3 class="text-lg font-semibold mb-2 text-green-400 flex items-center mt-4">
                    <i data-lucide="file-text" class="h-5 w-5 mr-2"></i> Raw Document Content
                </h3>
                <pre id="modalContent" class="bg-gray-800 p-4 rounded-lg text-sm text-white whitespace-pre-wrap font-mono border border-gray-700 overflow-x-auto"></pre>
            </div>
        </div>
    </div>


    <script>
        // --- Configuration ---
        // FIX: Reverted port reference back to :3000.
        const LOCAL_HOST_ORIGIN = window.location.origin.replace(/:\d+/, ':3000'); 
        const LOCAL_API_URL = LOCAL_HOST_ORIGIN + '/api/search';
        const AI_ANSWER_PROXY_URL = LOCAL_HOST_ORIGIN + '/api/ai-answer'; // <-- NEW PROXY URL
        
        // NEW API ENDPOINTS FOR ASYNCHRONOUS LOAD
        const DOCUMENT_CONTENT_URL = LOCAL_HOST_ORIGIN + '/api/document/content/';
        const DOCUMENT_SUMMARY_URL = LOCAL_HOST_ORIGIN + '/api/document/summary/'; 
        
        const MAX_RECENT_SEARCHES = 5;

        // FIXED LIST OF CATEGORIES
        const CATEGORIES = [
            'Engineering',
            'Animals',
            'Art',
            'Food',
            'Music',
            'Famous_Landmarks'
        ];

        // --- DOM Elements ---
        const searchInput = document.getElementById('search-input');
        const categorySelect = document.getElementById('category-select'); 
        const categoryBrowserList = document.getElementById('category-browser-list');
        const resultsContainer = document.getElementById('results-container');
        const resultsHeader = document.getElementById('results-header');
        const loadingIndicator = document.getElementById('loading-indicator');
        const recentSearchesList = document.getElementById('recent-searches-list');
        const initialMessage = document.getElementById('initial-message');
        const documentModal = document.getElementById('documentModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        const modalSummary = document.getElementById('modalSummary');
        const summaryControls = document.getElementById('summaryControls'); 
        
        // NEW AI Answer DOM elements
        const apiAnswerBox = document.getElementById('api-answer-box');
        const geminiAnswerContent = document.getElementById('gemini-answer-content');
        const geminiAnswerSources = document.getElementById('gemini-answer-sources');

        let recentSearches = JSON.parse(localStorage.getItem('recentSearches') || '[]');
        
        // --- Core Functions ---

        function renderCategoryList() {
            categoryBrowserList.innerHTML = '';
            
            CATEGORIES.forEach(category => {
                const li = document.createElement('li');
                const displayName = category.replace('_', ' ');
                
                li.className = 'cursor-pointer text-emerald-300 hover:text-green-400 hover:bg-gray-800 p-2 rounded-lg transition duration-150 flex items-center font-medium';
                li.innerHTML = `<i data-lucide="book-open-text" class="h-4 w-4 mr-2"></i>${displayName}`;
                
                li.onclick = () => {
                    categorySelect.value = category;
                    searchInput.value = '';
                    performSearch();
                };
                categoryBrowserList.appendChild(li);
            });
            lucide.createIcons();
        }

        /**
         * Renders the Gemini answer and sources into the dedicated box.
         * @param {string} text 
         * @param {Array<Object>} sources 
         */
        function renderGeminiAnswer(text, sources) {
            apiAnswerBox.classList.remove('hidden');
            geminiAnswerContent.innerHTML = text.replace(/\n/g, '<br>');

            if (sources && sources.length > 0) {
                const sourceHtml = sources.map((s, index) => 
                    `<a href="${s.uri}" target="_blank" class="source-link hover:text-white" title="${s.title || 'Source'}">
                        [${index + 1}]
                    </a>`
                ).join(' ');
                geminiAnswerSources.innerHTML = `Sources: ${sourceHtml}`;
            } else {
                geminiAnswerSources.textContent = 'No external sources cited.';
            }
            lucide.createIcons();
        }
        
        /**
         * Handles the request to the Flask proxy for a general query answer.
         * @param {string} query 
         */
        async function callGeminiAnswerAPI(query) {
            apiAnswerBox.classList.remove('hidden');
            geminiAnswerContent.innerHTML = `
                <div class="text-center py-2">
                    <svg class="animate-spin h-5 w-5 text-emerald-400 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="mt-1 text-xs text-gray-400">Generating AI Answer via secure server proxy...</p>
                </div>
            `;
            geminiAnswerSources.textContent = ''; // Clear previous sources

            const url = `${AI_ANSWER_PROXY_URL}?query=${encodeURIComponent(query)}`;

            try {
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`Server proxy returned status ${response.status}`);
                }
                
                const result = await response.json();
                
                // The Flask proxy returns an object with 'text' and 'sources'
                const generatedText = result.text || 'No answer generated.';
                const sources = result.sources || [];
                
                if (generatedText.includes("Error:") || generatedText.includes("Failed to connect")) {
                    // Check for server-side error messages passed in the 'text' field
                     geminiAnswerContent.innerHTML = `<p class="text-red-400">${generatedText}</p>`;
                     geminiAnswerSources.textContent = '';
                } else {
                    renderGeminiAnswer(generatedText, sources);
                }

            } catch (error) {
                console.error("AI Answer proxy call failed:", error);
                geminiAnswerContent.innerHTML = `<p class="text-red-400">Error generating AI Answer. Details: ${error.message}</p>`;
                geminiAnswerSources.textContent = '';
            }
        }


        /**
         * Renders the search/browsing results.
         */
        function displayResults(results, query) {
            resultsContainer.innerHTML = '';
            initialMessage.classList.add('hidden');
            const currentCategory = categorySelect.value;
            const isBrowsing = query.length === 0 && currentCategory !== 'All';
            const displayCategoryName = currentCategory.replace('_', ' ');

            if (isBrowsing) {
                 resultsHeader.innerHTML = `<i data-lucide="folder-open" class="h-5 w-5 mr-2"></i> Browsing Files in: ${displayCategoryName}`;
            } else {
                 resultsHeader.innerHTML = `<i data-lucide="list-checks" class="h-5 w-5 mr-2"></i> Search Results`;
            }

            if (results.length === 0) {
                if (isBrowsing) {
                    resultsContainer.innerHTML = `<p class="text-green-400 font-semibold">No files found in the ${displayCategoryName} folder. Check if files exist in the subdirectory.</p>`;
                } else {
                    resultsContainer.innerHTML = `<p class="text-green-400 font-semibold">No results found for "${query}" in the ${displayCategoryName} category.</p>`;
                }
                return;
            }

            results.forEach((result, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'p-4 bg-gray-700/50 rounded-lg border border-green-800 flex items-start space-x-4 hover:bg-gray-800 transition duration-150';
                
                const iconHtml = isBrowsing 
                    ? `<div class="w-10 h-10 bg-emerald-700 rounded-full flex items-center justify-center flex-shrink-0">
                            <i data-lucide="file-text" class="h-5 w-5 text-white"></i>
                        </div>`
                    : `<div class="w-10 h-10 bg-green-700 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-white font-bold">${index + 1}</span>
                        </div>`;

                itemDiv.innerHTML = `
                    ${iconHtml}
                    <div class="flex-grow">
                        <p class="text-lg font-medium text-white cursor-pointer hover:text-green-300" 
                            onclick="openDocument('${result.filename}')">${result.filename}</p>
                        ${isBrowsing 
                            ? `<p class="text-sm text-gray-400 mt-1">File Size/Type: TXT Document</p>` 
                            : `<p class="text-sm text-gray-400">Relevance Score: <span class="text-emerald-400 font-bold">${result.score}</span></p>`
                        }
                    </div>
                `;
                resultsContainer.appendChild(itemDiv);
            });
            lucide.createIcons();
        }

        /**
         * Core Search Logic.
         */
        async function performSearch() {
            const query = searchInput.value.trim();
            const category = categorySelect.value; 

            loadingIndicator.classList.remove('hidden');
            document.getElementById('suggestion-list').classList.add('hidden');
            resultsContainer.innerHTML = '';
            
            const url = `${LOCAL_API_URL}?query=${encodeURIComponent(query)}&category=${encodeURIComponent(category)}`;

            // --- 1. LLM Query Answer (ASYNCHRONOUS) ---
            if (query.length > 0 && category === 'All') {
                callGeminiAnswerAPI(query);
            } else {
                apiAnswerBox.classList.add('hidden');
                geminiAnswerContent.innerHTML = '';
            }

            // --- 2. Local C Engine Search (MAIN BLOCKING CALL) ---
            try {
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}.`);
                }

                const results = await response.json();
                
                if (results && results[0] && results[0].error) {
                    resultsContainer.innerHTML = `<p class="text-red-400 font-semibold">C Engine Error: ${results[0].error}</p>`;
                    return;
                }

                if (query.length > 0) {
                    updateRecentSearches(query);
                }
                
                displayResults(results, query);

            } catch (error) {
                console.error("Search failed:", error);
                resultsContainer.innerHTML = `
                    <div class="p-4 bg-red-800/30 border border-red-700 rounded-lg">
                        <p class="text-red-400 font-bold mb-2">Connection Error</p>
                        <p class="text-sm text-gray-300">Could not connect to the local server endpoint.</p>
                        <p class="text-xs mt-1 text-red-300">Ensure your Flask server is running.</p>
                    </div>
                `;
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }
        
        // --- NEW SUMMARY FUNCTIONS (Unchanged) ---

        /**
         * Displays the loading state for the summary section.
         */
        function showSummaryLoading() {
            summaryControls.innerHTML = `
                <div class="text-center py-2">
                    <svg class="animate-spin h-5 w-5 text-emerald-400 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="mt-1 text-xs text-gray-400">Generating summary, this may take a moment...</p>
                </div>
            `;
        }
        
        /**
         * Fetches and displays the LLM summary.
         * @param {string} filename 
         */
        async function generateSummary(filename) {
            showSummaryLoading();
            const encodedFilename = encodeURIComponent(filename);

            try {
                const summaryResponse = await fetch(DOCUMENT_SUMMARY_URL + encodedFilename);

                if (!summaryResponse.ok) {
                    throw new Error(`Failed to fetch summary: ${summaryResponse.status}`);
                }
                const summaryData = await summaryResponse.json();
                
                modalSummary.innerHTML = summaryData.summary.trim().startsWith('Error:') 
                    ? `<p class="text-red-400">${summaryData.summary}</p>` 
                    : `<div class="markdown">${summaryData.summary}</div>`;
                
                summaryControls.innerHTML = ''; // Clear controls after success
                lucide.createIcons();

            } catch (error) {
                console.error("Document summary fetch error:", error);
                summaryControls.innerHTML = `
                    <button onclick="generateSummary('${filename}')" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition duration-150 flex items-center justify-center">
                        <i data-lucide="refresh-cw" class="h-4 w-4 mr-2"></i> Error. Try Again
                    </button>
                `;
                modalSummary.innerHTML = `<p class="text-red-400">Failed to load or summarize document. Details: ${error.message}</p>`;
                lucide.createIcons();
            }
        }


        /**
         * UPDATED: Opens the modal, loads content instantly, and displays the summary button.
         * @param {string} filename The name of the file to fetch.
         */
        async function openDocument(filename) {
            documentModal.classList.remove('hidden');
            modalTitle.textContent = `Document Viewer: ${filename}`;
            modalContent.textContent = 'Loading raw content instantly...'; 
            
            // 1. Reset and prepare summary area for manual start
            modalSummary.innerHTML = '<p class="text-gray-500 italic">Click the button below to generate a concise LLM summary.</p>';
            summaryControls.innerHTML = `
                <button onclick="generateSummary('${filename}')" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-4 rounded transition duration-150 flex items-center justify-center">
                    <i data-lucide="zap" class="h-5 w-5 mr-2"></i> Generate Summary
                </button>
            `;
            lucide.createIcons();

            const encodedFilename = encodeURIComponent(filename);

            // --- A. FAST FETCH: RAW CONTENT (Auto-start) ---
            try {
                const contentResponse = await fetch(DOCUMENT_CONTENT_URL + encodedFilename);
                
                if (!contentResponse.ok) {
                    throw new Error(`Failed to fetch content: ${contentResponse.status}`);
                }
                const contentData = await contentResponse.json();
                
                // DISPLAY CONTENT INSTANTLY
                modalContent.textContent = contentData.content; 

            } catch (error) {
                console.error("Document content fetch error:", error);
                modalContent.textContent = `Error fetching raw content: ${error.message}`;
            }
        }

        // --- Helper / Initialization Functions (Unchanged) ---
        
        function updateRecentSearches(query) {
             query = query.trim().toLowerCase();
             if (!query) return;

             recentSearches = recentSearches.filter(q => q !== query);
             recentSearches.unshift(query);
            
             if (recentSearches.length > MAX_RECENT_SEARCHES) {
                 recentSearches.pop();
             }

             localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
             renderRecentSearches();
        }

        function renderRecentSearches() {
             document.getElementById('recent-searches-list').innerHTML = '';
             if (recentSearches.length === 0) {
                 document.getElementById('recent-searches-list').innerHTML = '<li class="text-gray-500 italic">No recent searches yet.</li>';
                 return;
             }

             recentSearches.forEach(query => {
                 const li = document.createElement('li');
                 li.className = 'cursor-pointer text-green-300 hover:text-green-400 hover:bg-gray-800 p-2 rounded-lg transition duration-150 flex items-center';
                 li.innerHTML = `<i data-lucide="chevrons-right" class="h-4 w-4 mr-2"></i>${query}`;
                 li.onclick = () => {
                     searchInput.value = query;
                     handleSearchClick(); 
                 };
                 document.getElementById('recent-searches-list').appendChild(li);
             });
             lucide.createIcons();
        }
        
        function renderSuggestions(input) {
            const suggestionList = document.getElementById('suggestion-list');
            suggestionList.innerHTML = '';
            const matchingQueries = recentSearches.filter(q => q.startsWith(input.toLowerCase()));

            if (input.length > 0 && matchingQueries.length > 0) {
                suggestionList.classList.remove('hidden');
                matchingQueries.forEach(query => {
                    const li = document.createElement('li');
                    li.className = 'p-3 cursor-pointer hover:bg-gray-800 transition duration-100';
                    li.textContent = query;
                    li.onclick = () => {
                        searchInput.value = query;
                        suggestionList.classList.add('hidden');
                        handleSearchClick();
                    };
                    suggestionList.appendChild(li);
                });
            } else {
                suggestionList.classList.add('hidden');
            }
        }

        function handleInput(event) {
            const input = searchInput.value.trim();
            // Clear category when user starts typing a new query
            if (input.length > 0 && categorySelect.value !== 'All') {
                categorySelect.value = 'All'; 
                resultsHeader.innerHTML = `<i data-lucide="list-checks" class="h-5 w-5 mr-2"></i> Search Results`;
            }
            
            renderSuggestions(input);
            if (event.key === 'Enter' && input.length > 0) {
                performSearch();
            }
        }

        function handleSearchClick() {
            if (document.getElementById('search-input').value.trim().length === 0) {
                 document.getElementById('category-select').value = 'All';
            }
            performSearch();
        }
        
        function closeModal() {
            documentModal.classList.add('hidden');
        }


        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons(); 
            renderRecentSearches();
            renderCategoryList(); 

            searchInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    performSearch();
                }
            });
            
            categorySelect.value = 'All';
        });
    </script>
</body>
</html>